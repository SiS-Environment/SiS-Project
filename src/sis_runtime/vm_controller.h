#ifndef VM_CONTROLLER_H
#define VM_CONTROLLER_H

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Includes
//
#include "vm_runtime_global.h"
#include "vm_eventmanager.h"
#include <sis_module.h>
//STL
#include <vector>
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
namespace sis {
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
namespace vm {
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
class CProcessor;
class CModuleManager;
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	class CController
//
class SIS_RUNTIME_EXPORT CController final : public CProceEventManager
{
private:
	enum class EState : char
	{
		NotStarted,
		Running,
		Breaked,
	};

public:
	// Constructors, destructor
	CController( CModuleManager* pModuleManager );
	virtual ~CController();

	// Copy constructor and assignment operator
	CController( CController const& ) = delete;
	CController& operator=( CController const& ) = delete;

public:
	// Interface methods

	// Start running
	void Start();
	// Create new processor and run it
	void RunNewProcessor( std::string const& sModuleName );
	// Delete all processes
	void KillAll();

protected:
	// Handle events
	virtual void HandleEvents() override;
	
private:
	// Create new processor
	CProcessor* CreateProcessor();
	// Kill processor
	void KillProcessor( CProcessor* );

private:
	// Members
	CModuleManager* m_pModuleManager;
	std::vector<CProcessor*> m_arrProcessors;
};
//	CController
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
} // namespace vm
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
} // namespace sis
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


#endif // VM_CONTROLLER_H
// end of file
